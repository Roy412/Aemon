# Aemon

Aemon is a the UI library that empowers our consumer site (`varys`). Before start working on this project, it's important to know and understand our development process:

* [Dev Process](https://docs.google.com/document/d/1uCjFRPyoEttumeFD021zahaptu6-cU4zyLjV6Cx7qfg)
* [Design + Dev Process](https://docs.google.com/document/d/187PdZdjwjTO4n1IQdK8VPZHtYhhjD_KmYb5u88aIO7U)

[![Maintainability](https://api.codeclimate.com/v1/badges/049592dcc0608f7011bd/maintainability)](https://codeclimate.com/repos/5c096be7dccec43bdc00bc36/maintainability)
[![Test Coverage](https://api.codeclimate.com/v1/badges/049592dcc0608f7011bd/test_coverage)](https://codeclimate.com/repos/5c096be7dccec43bdc00bc36/test_coverage)
[![CircleCI](https://circleci.com/gh/paybygroup/aemon.svg?style=svg&circle-token=a3f162c4f1d7591843c96b61d5c5fd32f5efd83f)](https://circleci.com/gh/paybygroup/aemon)

## Getting Started

### Prerequisites

For development, you will only need Node.js installed on your environment. Please use the appropriate [EditorConfig plugin](https://editorconfig.org/#download) for your editor.

You should be able to run the following command after the installation procedure.

```
$ node --version

$ npm --version
```

### Installing

First, clone this repo if you didn't yet.

```
$ git clone https://github.com/paybygroup.com/aemon.git
```

Then, install all node packages required by this project.

```
$ npm install
```

### Start & watch

The following command should start Storybook server in a random port and open a new browser tab.

```
$ npm run storybook
```

Now you can develop your components and write stories and see the changes in Storybook immediately since it uses Webpackâ€™s hot module reloading.

## Running the tests

To run the whole testing suite:

```
$ npm tests
```

To keep running the tests for a single component, run the following command:

```
$ npx mocha ./test/config/index.js ./test/consumer/desktop/your-component.test.js --watch
```

To verify the test coverge, you can run:

```
$ npm run test:cover
$ open coverage/lcov-report/index.html
```

## File structure

```
.
|-- components
|   |-- consumer
|   |   |-- desktop
|   |   |   |-- activity-card
|   |   |   |   |-- activity-card.js
|   |   |   |   |-- index.js
|   |   |   |   |-- style.css
|   |   |   |   `-- style.scss
|   |   |   ...
|   |   |-- mobile
|   |   |   |-- activity-card
|   |   |   |   |-- activity-card.js
|   |   |   |   |-- index.js
|   |   |   |   |-- style.css
|   |   |   |   `-- style.scss
|   |   |   ...
|   |   `-- shared
|   |-- lib
|   `-- index.js
|-- stories
|   |-- consumer
|   |   |-- desktop
|   |   |   |-- activity-card.story.js
|   |   |   ...
|   |   `-- mobile
|   |       |-- activity-card.story.js
|   |       ...
|   ...
|-- test
|   |-- consumer
|   |   |-- desktop
|   |   |   |-- activity-card.test.js
|   |   |   ...
|   |   |-- mobile
|   |   |   |-- activity-card.test.js
|   |   |   ...
|   |   `-- shared
|   ...
...
```

The main directories are `components`, `stories` and `test`.

### components/

This is where all components are defined. They are clasify as `desktop` or `mobile`. Every component is composed by tree files:

* `index.js`: imports the content of the component's main file
* `component-name.js`: contains the component JS/JSX code
* `style.scss`: contains the component CSS styles in SCSS

All `style.css` files are autogenerated from `scss` versions but they should be committed to Git as well.

### stories/

This is where all Storybook stories are defined. It has a very similar directory structure than `components`. There should be one story file per component named after it but replacing `.js` with `.story.js` suffix.

### test/

This is where all unit tests are defined. It has a very similar directory structure than `components`. There should one test file per component named after it but replacing `.js` with `.story.js` suffix.

## Releasing

In order to make the latest changes available to `varys` you should create a new realease.

First, make sure you are that your `master` bran in the HEAD commit.

```
$ git checkout master
$ git pull
```

Then, move to `latest-release` branch and merge it into `master`.

```
$ git checkout latest-release
$ git pull
$ git merge master
```

Then, bump `version` in `package.json` file by following [semantic versioning](https://semver.org/) rules. After that, commit and push the changes:

```
$ git commit -a -m "Bump version to X.Y.Z."
$ git push
```

Finally, realse the new version by creating and pushing a new git tag:

```
$ git tag X.Y.Z
$ git push --tags
```

Once the realese is ready, you should update `aemon` version in `varys` `package.json` file and run:

```
$ npm install
```
